
<!DOCTYPE html>
<html>
<head>
  <title>Subir cat√°logo a Firestore (SDK Modular - FIX3)</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDqMtZxhXypN1zL1C1yxEWzZi2IcESVC8s",
      authDomain: "catalogofire.firebaseapp.com",
      projectId: "catalogofire",
      storageBucket: "catalogofire.appspot.com",
      messagingSenderId: "946190549117",
      appId: "1:946190549117:web:37a287527348b6b95ef114"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.subirCatalogo = async function () {
      const input = document.getElementById('jsonFile');
      const file = input.files[0];
      const output = document.getElementById('output');

      if (!file) {
        alert("Selecciona un archivo JSON primero.");
        return;
      }

      const reader = new FileReader();
      reader.onload = async function (event) {
        const raw = JSON.parse(event.target.result);
        const data = Array.isArray(raw) ? raw : raw.catalogo || [];

        let procesados = 0;

        for (const articulo of data) {
          if (!articulo.clave) {
            console.error("‚ùå El art√≠culo no tiene campo 'clave'.", articulo);
            continue;
          }
          try {
            await setDoc(doc(db, "articulos", articulo.clave), {
              nombre: articulo.nombre,
              departamento: articulo.departamento,
              linea: articulo.linea,
              costo: articulo.costo,
              precios: articulo.precios
            }, { merge: true });

            procesados++;
            output.textContent = `‚úÖ ${procesados} art√≠culos subidos...`;
          } catch (error) {
            console.error("‚ùå Error con clave:", articulo.clave, error);
          }
        }

        output.textContent += "\nüéâ Proceso completo.";
      };

      reader.readAsText(file);
    }
  </script>
</head>
<body>
  <h2>üì¶ Subir cat√°logo de art√≠culos a Firestore (SDK Modular - FIX3)</h2>
  <input type="file" id="jsonFile" />
  <button onclick="subirCatalogo()">Subir a Firestore</button>
  <pre id="output"></pre>
</body>
</html>
